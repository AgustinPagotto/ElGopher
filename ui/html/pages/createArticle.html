{{define "title"}}New Article{{end}} {{define "main"}}
<div class="scnd-header">
  <h1>New Article</h1>
</div>
<div id="form-errors" role="alert" aria-live="polite"></div>
<form
  {{if
  .Article.ID}}
  hx-patch="/article/{{.Article.ID}}"
  {{else}}
  hx-post="/article/create"
  {{end}}
  hx-target="#form-errors"
  hx-swap="innerHTML"
  hx-indicator="#article-spinner"
  novalidate
  aria-label="Article editor form"
>
  <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
  <label for="title">
    Title
    <input
      type="text"
      id="title"
      name="title"
      value="{{.Article.Title}}"
      placeholder="Enter the post title"
      required
      aria-required="true"
      aria-describedby="title-error"
      hx-trigger="change delay:500ms"
      hx-get="/article/create"
      hx-target="#title-error"
    />
    <span id="title-error" role="alert">{{template "field_error" .Form.FieldErrors.title}}</span>
  </label>
  <label for="body">
    Body
    <textarea
      name="body"
      id="body"
      placeholder="Enter the post content"
      required
      aria-required="true"
      aria-describedby="body-error"
      hx-trigger="change delay:500ms"
      hx-get="/article/create"
      hx-target="#body-error"
      onInput="this.parentNode.dataset.replicatedValue = this.value"
    >
{{.Article.Body}}</textarea
    >
    <span id="body-error" role="alert">{{template "field_error" .Form.FieldErrors.body}}</span>
  </label>
  <label for="preview">
    Preview
    <input
      type="checkbox"
      role="switch"
      name="preview"
      id="preview"
      aria-label="Toggle article preview"
      hx-include="#body"
      hx-trigger="change"
      hx-get="/article/create"
      hx-target="#preview-area"
      hx-indicator="#preview-spinner"
    />
    <span id="preview-spinner" class="htmx-indicator" aria-hidden="true">⏳</span>
  </label>
  {{template "article_preview" .}}
  <label for="publish">
    Publish Now?
    <input
      type="checkbox"
      id="publish"
      name="publish"
      role="switch"
      aria-label="Publish article immediately"
      {{if
      .Article.IsPublished}}checked{{end}}
    />
  </label>

  {{if .Article.ID}}
  <button type="submit" aria-label="Update article">
    <span>Edit Post</span>
    <span id="article-spinner" class="htmx-indicator" aria-hidden="true">⏳</span>
  </button>
  {{else}}
  <button type="submit" aria-label="Save new article">
    <span>Save Post</span>
    <span id="article-spinner" class="htmx-indicator" aria-hidden="true">⏳</span>
  </button>
  {{end}}
</form>
{{end}}
